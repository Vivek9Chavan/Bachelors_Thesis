%% WELL STIRRED MODEL (RADIATION SECTION) :
% INTRODUCTORY TEXT

function T = Tgas2(Tg,di,Ptot,Emat,As,Twall,mf,AF,CV1,Tatm,Nco2,Nh2o,No2,Nn2,n)

%% Inputs and initial calculations :


Ntot = (Nco2 + Nh2o +No2 + Nn2);

Xh2o = Nh2o/Ntot;
Xco2 = Nco2/Ntot;
Xo2= No2/Ntot;
Xn2 = Nn2/Ntot;
CV = CV1*1000;

Pwat = Xh2o*Ptot;
Pcoo = Xco2*Ptot;
do = di*3.28084;
pi = Pwat*0.9*do;
pc = Pcoo*0.9*do;

Povl = Pwat/(Pwat + Pcoo);
py = (Pwat + Pcoo)*0.9*do;

%% Calculation of Correction factor :

pcw = (Pwat + Ptot)/2;
pcc = (Pcoo + Ptot)/2;
xcw = [0 .2 .4 .6 .8 1 1.2];
xcc = [.05 .08 .1 .2 .3 .5 .8 1 2 3 5];
if pi<.005;
    %pi = 0.005
    ycw = [.12 .48 .84 1.12 1.37 1.57 1.72];
elseif pi>=.005 &&pi<.1225;
    %pi = 0.005
    ycw = [.12 .48 .84 1.12 1.37 1.57 1.72];
elseif pi>=.1225 &&pi<.375;
    %pi = 0.25
    ycw = [.19 .54 .85 1.11 1.34 1.52 1.66];
elseif pi>=.375 &&pi<.75;
    %pi = 0.5
    ycw = [.26 .59 .87 1.1 1.3 1.45 1.55];
elseif pi>=.75 &&pi<1.75;
    %pi = 1.0
    ycw = [.37 .64 .89 1.08 1.26 1.38 1.43];
elseif pi>=1.75 &&pi<3.75;
    %pi = 2.5
    ycw = [.45 .68 .9 1.07 1.21 1.31 1.36];
elseif pi>=3.75 &&pi<7.5;
    %pi = 5.0
    ycw = [.55 .72 .91 1.06 1.1 1.25 1.29];    
elseif pi>= 7.5
    %pi = 10
    ycw = [.58 .77 .93 1.04 1.12 1.2 1.23];
end
    
if pc<.002;
    %pc = .002
    ycc = [.33 .36 .4 .55 .66 .8 .95 1.1 1.15 1.17 1.2];
elseif pc>=.002 && pc<.035;
    %pc = .002
    ycc = [.33 .36 .4 .55 .66 .8 .95 1.1 1.15 1.17 1.2];
elseif pc>=.035 && pc<.085;
    %pc = .05
    ycc = [.37 .43 .46 .6 .7 .83 .967 1.1 1.317 1.487 1.617];    
elseif pc>=.085 && pc<.185;
    %pc = .12
    ycc = [.44 .49 .53 .65 .75 .86 .984 1.1 1.284 1.424 1.534];
elseif pc>=.185 && pc<.375;
    %pc = .25
    ycc = [.5 .55 .57 .7 .79 .89 1.001 1.1 1.251 1.361 1.451];    
elseif pc>=.375 && pc<.75;
    %pc = .5
    ycc = [.56 .6 .62 .75 .83 .92 1.018 1.1 1.218 1.298 1.368];    
elseif pc>=.75 && pc<1.75;
    %pc = 1.0
    ycc = [.62 .68 .7 .81 .86 .95 1.035 1.1 1.185 1.235 1.281];
elseif pc>=1.75;
    %pc = 2.5
    ycc = [.7 .74 .78 .87 .92 .98 1.052 1.1 1.152 1.17 1.2];
end

polw = polyfit(xcw,ycw,1);
polc = polyfit(xcc,ycc,1);
Cw = polyval(polw,pcw);
Cc = polyval(polc,pcc);
    
%% Looping :

for i = 1:n;
%% Discretization of PwL and curve points :

if pi<0.005;
    %pw = 0.005%
    xw = 300:100:800;
    yw = [0.0175 0.015 0.0125 0.0105 0.0088 0.0074];
elseif pi>=0.005 &&pi<=0.006;
    %pw = 0.005;%
    xw = 300:100:800;
    yw = [0.0175 0.015 0.0125 0.0105 0.0088 0.0074];
elseif pi>0.006 &&pi<=0.0085;
   % pw = 0.007;%
    xw = 300:100:900;
    yw = [0.0225 0.019 0.0165 0.0135 0.012 0.0095 0.0081];
elseif pi>0.0085 &&pi<=0.0125;
    %pw = 0.01;
    xw = 300:100:1100;
    yw = [0.03 0.025 0.0233 0.0185 0.016 0.0132 0.012 0.0095 0.0082];
elseif pi>0.0125 &&pi<=0.0175;
    %pw = 0.015;
    xw = 300:100:1300;
    yw = [.04 .035 .03 .025 .022 .0185 .016 .0135 .012 .01 .0088];
elseif pi>0.0175 &&pi<=0.03;
    %pw = 0.02;
    xw = 300:100:1400;
    yw = [.05 .045 .037 .033 .0275 .023 .02 .0175 .015 .013 .0115 .095];
elseif pi>0.03 &&pi<=0.05; %pw = 0.04%
    %pw = 0.04;
    xw = 300:100:2000;
    yw = [.078 .065 .057 .052 .045 .04 .035 .0315 .0275 .021 .018 .016 .0135 .0125 .011 .0093 .008];
elseif pi>0.05 &&pi<=0.08;
    %pw = 0.06;
    xw = 300:100:2100;
    yw = [.095 .08 .073 .067 .06 .054 .048 .043 .0375 .033 .029 .0255 .023 .02 .018 .016 .014 .0125 .011];
elseif pi>0.08 &&pi<=0.15;
    %pw = 0.1;
    xw = 300:100:2100;
    yw = [.12 .1 .095 .09 .082 .076 .07 .061 .055 .05 .045 .04 .036 .0325 .029 .026 .023 .021 .019];
elseif pi>0.15 &&pi<=0.3;
    %pw = 0.2;
    xw = 300:100:2100;
    yw = [.175 .15 .14 .135 .13 .12 .11 .095 .088 .08 .073 .066 .06 .055 .05 .045 .041 .0375 .034];
elseif pi>0.3 &&pi<=0.5;
    %pw = 0.4;
    xw = 300:100:2100;
    yw = [.225 .2 .19 .185 .18 .17 .15 .14 .13 .12 .11 .1 .095 .09 .082 .075 .07 .065 .06];
elseif pi>0.5 &&pi<=0.8;
    %pw = 0.6;
    xw = 300:100:2100;
    yw = [.27 .24 .235 .23 .22 .2 .18 .175 .16 .15 .14 .13 .125 .12 .11 .098 .09 .085 .08];
elseif pi>0.8 &&pi<=1.5;
    %pw = 1;
    xw = 300:100:2100;
    yw = [.35 .29 .28 .275 .27 .25 .24 .23 .21 .2 .185 .175 .16 .15 .14 .13 .125 .12 .11];
elseif pi>1.5 &&pi<=2.5;
    %pw = 2;
    xw = 300:100:2100;
    yw = [.4 .375 .36 .35 .34 .33 .32 .3 .275 .26 .25 .23 .22 .2 .19 .18 .17 .16 .15];
elseif pi>2.5 &&pi<=3.5;
    %pw = 3;
    xw = 300:100:2100;
    yw = [.45 .42 .4 .395 .39 .38 .37 .35 .33 .31 .29 .275 .26 .24 .23 .21 .2 .19 .18];
elseif pi>3.5 &&pi<=7.5;
    %pw = 5;
    xw = 300:100:2100;
    yw = [.525 .49 .48 .47 .46 .45 .42 .4 .37 .35 .34 .32 .3 .28 .27 .25 .24 .23 .22];
elseif pi>7.5 &&pi<=15;
    %pw = 10;
    xw = 300:100:2100;
    yw = [.6 .55 .55 .55 .54 .52 .5 .48 .47 .44 .42 .39 .37 .35 .34 .32 .3 .28 .27];
elseif pi>15;
    %pw = 20;
    xw = 300:100:2100;
    yw = [.65 .61 .6 .6 .6 .6 .6 .57 .55 .5 .48 .46 .45 .42 .4 .39 .37 .35 .32];
end

%% Polynomial fitting and evaluation :

pfw = polyfit(xw,yw,2);
Ew = polyval(pfw,Tg);

%% Discretization of PcL and curve pionts :

if pc<0.001;
    %pc = 0.001%
    xc = 700:100:1400;
    yc = [.0048 .004 .0035 .0032 .0028 .0024 .0024 .0016];
elseif pc>=0.001 &&pc<=0.0015;
    %pc = 0.001;%
    xc = 700:100:1400;
    yc = [.0048 .004 .0035 .0032 .0028 .0024 .0024 .0016];
elseif pc>0.0015 &&pc<=0.0025;
   % pc = 0.002;%
    xc = 800:100:1900;
    yc = [.0094 .0089 .0083 .0076 .007 .0061 .005 .0038 .0033 .0027 .0022 .0018];
elseif pc>0.0025 &&pc<=0.0035;
    %pc = 0.003;
    xc = 600:100:2100;
    yc = [.0145 .014 .0135 .013 .012 .011 .01 .009 .008 .007 .006 .0046 .0036 .003 .0025 .0021];
elseif pc>0.0035 &&pc<=0.0045;
    %pc = 0.004;
    xc = 600:100:2100;
    yc = [.018 .0175 .017 .016 .015 .014 .0125 .011 .01 .0088 .0078 .007 .006 .0046 .0036 .0032];
elseif pc>0.0045 &&pc<=0.0055;
    %pc = 0.005;
    xc = 600:100:2100;
    yc = [.021 .0215 .02 .019 .018 .017 .015 .0135 .0125 .011 .0095 .0085 .0075 .0067 .0057 .0042];
elseif pc>0.0055 &&pc<=0.008;
    %pc = 0.006;
    xc = 500:100:2100;
    yc = [.022 .023 .024 .0235 .022 .021 .019 .018 .0165 .014 .013 .012 .01 .009 .008 .007 .0062];
elseif pc>0.008 &&pc<=0.015;
    %pc = 0.01;
    xc = 400:100:2100;
    yc = [.028 .029 .03 .031 .03 .3 .028 .027 .025 .023 .021 .019 .017 .015 .013 .012 .01 .009];
elseif pc>0.015 &&pc<=0.03;
    %pc = 0.02;
    xc = 500:100:2100;
    yc = [.04 .043 .045 .044 .042 .039 .037 .035 .032 .028 .026 .023 .02 .018 .016 .014];
elseif pc>0.03 &&pc<=0.05;
    %pc = 0.04;
    xc = 400:100:2100;
    yc = [.048 .043 .045 .045 .044 .042 .039 .037 .035 .032 .02 .026 .023 .02 .018 .016];
elseif pc>0.05 &&pc<=0.08;
    %pc = 0.06;
    xc = 400:100:2100;
    yc = [.058 .06 .062 .066 .069 .07 .069 .067 .063 .058 .054 .048 .044 .038 .035 .03 .027 .024];
elseif pc>0.08 &&pc<=0.15;
    %pc = 0.1;
    xc = 400:100:2100;
    yc = [.068 .069 .072 .078 .08 .082 .081 .08 .075 .069 .064 .057 .052 .047 .042 .037 .033 .028];
elseif pc>0.15 &&pc<=0.3;
    %pc = 0.2;
    xc = 400:100:2100;
    yc = [.084 .085 .088 .092 .097 .1 .099 .097 .096 .088 .082 .076 .068 .062 .055 .05 .045 .039];
elseif pc>0.3 &&pc<=0.6;
    %pc = 0.4;
    xc = 400:100:2100;
    yc = [.098 .099 .10 .11 .12 .13 .13 .125 .12 .115 .1 .94 .088 .081 .073 .067 .06 .054];
elseif pc>0.6 &&pc<=0.9;
    %pc = 0.8;
    xc = 400:100:2100;
    yc = [.12 .125 .13 .135 .14 .145 .15 .15 .145 .14 .13 .12 .11 .1 .09 .084 .076 .068];
elseif pc>0.9 &&pc<=1.5;
    %pc = 1.0;
    xc = 400:100:2100;
    yc = [.13 .135 .14 .145 .15 .155 .16 .16 .155 .15 .145 .135 .125 .115 .1 .09 .084 .077];
elseif pc>1.5 &&pc<=3.0;
    %pc = 2.0;
    xc = 400:100:2100;
    yc = [.145 .15 .16 .17 .18 .185 .19 .195 .19 .18 .17 .16 .15 .135 .125 .115 .1 .094];
elseif pc>3.0;
    %pc = 4.0;
    xc = 400:100:2000;
    yc = [.17 .18 .185 .195 .2 .21 .22 .23 .22 .21 .2 .195 .18 .170 .16 .14 .13];
end

%% Polynomial fitting and evaluation :

pfc = polyfit(xc,yc,1);
Ec = polyval(pfc,Tg);

%% Calculation of overlap factor :
if Tg<800;
    if py<.2;
        %py = .2
        xov = [.6 .8 1];
        yov = [0 .002 0];
    elseif py>=.2 && py<.25;
        %py = .2
        xov = [.6 .8 1];
        yov = [0 .002 0];
    elseif py>=.25 && py<.4;
        %py = .3
        xov = [.4 .6 .8 1];
        yov = [0 .003 .004 0];    
    elseif py>=.4 && py<.625;
        %py = .5
        xov = [.4 .6 .8 1];
        yov = [.001 .003 .005 0];
    elseif py>=.625 && py<.875;
        %py = .75
        xov = [.2 .4 .6 .8 1];
        yov = [0 .003 .007 .009 0];
    elseif py>=.875 && py<1.25;
        %py = 1.0
        xov = [.2 .4 .6 .8 1];
        yov = [.002 .006 .011 .013 0];
    elseif py>=1.25 && py<1.75;
        %py = 1.5
        xov = [.2 .4 .6 .8 1];
        yov = [.003 .01 .016 .0185 0];
    elseif py>=1.75 && py<2.5;
        %py = 2.0
        xov = [0 .2 .4 .6 .8 1];
        yov = [0 .006 .014 .021 .028 0];
    elseif py>=2.5 && py<3.5;
        %py = 3.0
        xov = [0 .2 .4 .6 .8 1];
        yov = [0 .013 .023 .03 .034 0];
    elseif py>=3.5;
        %py = 4.0
        xov = [0 .2 .4 .6 .8 1];
        yov = [0 .017 .032 .043 .050 0];
    end

elseif Tg>=800 && Tg<1200;
    xov = [0 .2 .4 .6 .8 1];
    if py<.2;
        %py = .2
        yov = [0 .0005 .001 .001 .0005 0];
    elseif py>=.2 && py<.25;
        %py = .2
        yov = [0 .0005 .001 .001 .0005 0];
    elseif py>=.25 && py<.4;
        %py = .3
        yov = [0 .0015 .002 .0025 .0015 0];    
    elseif py>=.4 && py<.625;
        %py = .5
        yov = [0 .003 .007 .007 .003 0];
    elseif py>=.625 && py<.875;
        %py = .75
        yov = [0 .006 .0125 .013 .008 0];
    elseif py>=.875 && py<1.25;
        %py = 1.0
        yov = [0 .01 .015 .018 .014 0];
    elseif py>=1.25 && py<1.75;
        %py = 1.5
        yov = [0 .014 .02 .022 .02 0];
    elseif py>=1.75 && py<2.5;
        %py = 2.0
        yov = [0 .017 .024 .025 .024 0];
    elseif py>=2.5 && py<3.5;
        %py = 3.0
        yov = [0 .021 .026 .029 .027 0];
    elseif py>=3.5;
        %py = 4.0
        yov = [0 .025 .032 .034 .033 0];
    end
elseif Tg>=1200;
    if py<.2;
        %py = .2
        xov = [.2 .4 .6 .8];
        yov = [0 .001 .001 0];
    elseif py>=.2 && py<.25;
        %py = .2
        xov = [.2 .4 .6 .8];
        yov = [0 .001 .001 0];
    elseif py>=.25 && py<.4;
        %py = .3
        xov = [.2 .4 .6 .8];
        yov = [0 .005 .005 0];    
    elseif py>=.4 && py<.625;
        %py = .5
        xov = [.2 .4 .6 .8 1];
        yov = [.003 .017 .017 .005];
    elseif py>=.625 && py<.875;
        %py = .75
        xov = [.2 .4 .6 .8 1];
        yov = [.012 .02 .02 .015 0];
    elseif py>=.875 && py<1.25;
        %py = 1.0
        xov = [0 .2 .4 .6 .8 1];
        yov = [0 .021 .037 .04 .02 0];
    elseif py>=1.25 && py<1.75;
        %py = 1.5
        xov = [0 .2 .4 .6 .8 1];
        yov = [0 .03 .044 .044 .037 0];
    elseif py>=1.75 && py<2.5;
        %py = 2.0
        xov = [0 .2 .4 .6 .8 1];
        yov = [0 .04 .046 .047 .044 0];
    elseif py>=2.5 && py<3.5;
        %py = 3.0
        xov = [0 .2 .4 .6 .8 1];
        yov = [.045 .051 .052 .049 0];
    elseif py>=3.5;
        %py = 4.0
        xov = [0 .2 .4 .6 .8 1];
        yov = [.049 .054 .055 .054];
    end
end

pn = polyfit(xov,yov,3);
dE = polyval(pn,Povl);

%% Emmissivity of the gas :

Eg = Cw*Ew + Cc*Ec - dE;

%% Specific heat of the mixture :

tsp=[-50 0 50 100 10 200 300 400 500 1000 1500 2000];
sc = [746 811 866 914.8 957.4 995.4 1060 1112 1156 1292 1356 1387];
sn=[957.3 1035 1042 1041 1043 1050 1070 1095 1120 1213 1266 1297];
so=[984.4 928.7 921.7 931.8 947.6 964.7 997.1 1025 1048 1121 1165 1201];
sh=[1892 1874 1874 1887 1908 1935 1997 2066 2137 2471 2736 2928];
fco2 = polyfit(tsp,sc,3);
fn2 = polyfit(tsp,sn,3);
fo2 = polyfit(tsp,so,3);
fh2o = polyfit(tsp,sh,3);

Sco2 = polyval(fco2,Tg);
Sn2 = polyval(fn2,Tg);
So2 = polyval(fo2,Tg);
Sh2o = polyval(fh2o,Tg);

Smix = ((Sco2*Xco2*44)+(Sn2*Xn2*28)+(So2*Xo2*32)+(Sh2o*Xh2o*18))/((Xco2*44)+(Xn2*28)+(Xo2*32)+(Xh2o*18));


%% Heat generated :
 
Qg = As*(1/((1/Emat)+(1/Eg)-1))*5.67e-8*(Tg^4-Twall^4);

%% Calculation of new Tg :

Enf = mf*CV/3600;

Tmix = ((Enf-Qg)/(AF*mf*Smix/3600))+Tatm;

Tg = Tmix;
end

T = Tmix;

fprintf('\nThe emmissivity of gas mixture is :');
disp(Eg);
fprintf('\nThe Specific heat is :');
disp(Smix);
fprintf('\nThe heat transferred is :');
disp(Qg);



